<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 é»„é‡‘ç‰›å¸‚å¤ç›˜ (çœŸå®è¡Œæƒ…ç‰ˆ)</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f2f5; font-family: 'Microsoft YaHei', sans-serif; }
        
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
        }

        .header {
            position: absolute; top: 20px; left: 20px; pointer-events: auto;
            background: rgba(255,255,255,0.8); padding: 15px; border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); backdrop-filter: blur(5px);
        }
        h1 { margin: 0; font-size: 22px; color: #1a1a1a; display: flex; align-items: center; gap: 10px; }
        .badge { background: #ffd700; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .sub-text { font-size: 13px; color: #666; margin-top: 5px; }

        /* åº•éƒ¨æ§åˆ¶æ  */
        #controls {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            pointer-events: auto; display: flex; gap: 15px;
            background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 30px;
            backdrop-filter: blur(10px);
        }
        button {
            background: #1890ff; color: white; border: none; padding: 10px 24px;
            font-size: 15px; font-weight: bold; border-radius: 20px; cursor: pointer;
            transition: all 0.2s;
        }
        button:hover { transform: scale(1.05); background: #40a9ff; }
        button.stop { background: #ff4d4f; }
        button.stop:hover { background: #ff7875; }

        /* æ‚¬æµ®æç¤ºæ¡† */
        #tooltip {
            position: absolute; display: none;
            background: rgba(0, 0, 0, 0.85); color: #fff;
            padding: 12px 16px; border-radius: 8px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            pointer-events: none; border: 1px solid #444;
            min-width: 160px; z-index: 100;
        }
        #tooltip h3 { margin: 0 0 8px 0; font-size: 14px; color: #aaa; border-bottom: 1px solid #555; padding-bottom: 5px; }
        #tooltip .price-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 4px;}
        #tooltip .price { font-size: 24px; font-weight: bold; color: #ffd700; font-family: 'DIN Alternate', sans-serif; }
        #tooltip .percent { font-size: 16px; font-weight: bold; }
        
        .txt-red { color: #ff4d4f; }
        .txt-green { color: #00cc66; }

        /* å…³é”®äº‹ä»¶æ ‡è®° */
        .event-marker {
            position: absolute;
            background: #ffd700; color: #000;
            padding: 4px 8px; border-radius: 4px;
            font-size: 12px; font-weight: bold;
            transform: translate(-50%, -150%);
            white-space: nowrap;
            pointer-events: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="header">
            <h1>ğŸ“… 2025 é»„é‡‘ç‰›å¸‚å®å½• <span class="badge">REAL DATA</span></h1>
            <p class="sub-text">åŸºäº2025çœŸå®å¸‚åœºè¡Œæƒ… (Jan $2798 â” Dec $4510)</p>
        </div>

        <div id="tooltip">
            <h3 id="tt-date">2025-01-01</h3>
            <div class="price-row">
                <span class="price" id="tt-price">$2650</span>
            </div>
            <div class="price-row">
                <span style="font-size:12px; color:#888;">å½“æ—¥æ¶¨è·Œ</span>
                <span id="tt-percent" class="percent">-0.5%</span>
            </div>
        </div>

        <div id="controls">
            <button id="toggleBtn" onclick="toggleFlight()">â¸ æš‚åœå·¡èˆª</button>
            <button onclick="resetCamera()">ğŸ”„ é‡ç½®è§†è§’</button>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- æ ¸å¿ƒï¼š2025å¹´çœŸå®é»„é‡‘èµ°åŠ¿æ•°æ®å¼•æ“ ---
        // åŸºäºçœŸå®å¸‚åœºæ•°æ® (æ•°æ®æ¥æº: Investing/TradingEconomics 2025 Historical)
        // å…³é”®èŠ‚ç‚¹ï¼šå¹´åˆ2800 -> 5æœˆéœ‡è¡ -> 9æœˆèµ·é£ -> 10æœˆç ´4000 -> å¹´åº•4500
        const keyPoints = [
            { month: 0, price: 2798.20 }, // 1æœˆå¼€ç›˜
            { month: 1, price: 2876.21 }, // 2æœˆ
            { month: 2, price: 3086.34 }, // 3æœˆï¼šåˆéœ²é”‹èŠ’
            { month: 3, price: 3273.50 }, // 4æœˆ
            { month: 4, price: 3289.55 }, // 5æœˆï¼šé«˜ä½ç›˜æ•´
            { month: 5, price: 3266.41 }, // 6æœˆï¼šå°å¹…å›è°ƒ
            { month: 6, price: 3285.78 }, // 7æœˆï¼šè“„åŠ¿
            { month: 7, price: 3415.77 }, // 8æœˆï¼šå¯åŠ¨
            { month: 8, price: 3836.23 }, // 9æœˆï¼šä¸»å‡æµªå¼€å§‹ï¼
            { month: 9, price: 4002.77 }, // 10æœˆï¼šå†å²æ€§çªç ´4000
            { month: 10, price: 4217.36 },// 11æœˆï¼šé€¼ç©ºä¸Šæ¶¨
            { month: 11, price: 4479.44 },// 12æœˆ
            { month: 12, price: 4521.96 } // å¹´åº•æ”¶å®˜
        ];

        // è¾…åŠ©ï¼šç”Ÿæˆæ–‡å­—è´´å›¾
        function createTextTexture(text, color='#333333') {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'rgba(0,0,0,0)';
            ctx.clearRect(0,0,512,128);
            ctx.font = 'bold 70px "Microsoft YaHei", sans-serif';
            ctx.fillStyle = color;
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, 10, 64);
            return new THREE.CanvasTexture(canvas);
        }

        // --- 1. åœºæ™¯åˆå§‹åŒ– ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xe6e9f0);
        scene.fog = new THREE.Fog(0xe6e9f0, 30, 120);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        // ç¯å…‰ç³»ç»Ÿ
        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.6);
        scene.add(hemiLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(50, 80, 50);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 2048;
        dirLight.shadow.mapSize.height = 2048;
        scene.add(dirLight);

        // --- 2. æ•°æ®ç”Ÿæˆ (æ’å€¼ç®—æ³•) ---
        const yearData = [];
        const monthNames = ["1æœˆ Jan", "2æœˆ Feb", "3æœˆ Mar", "4æœˆ Apr", "5æœˆ May", "6æœˆ Jun", "7æœˆ Jul", "8æœˆ Aug", "9æœˆ Sep", "10æœˆ Oct", "11æœˆ Nov", "12æœˆ Dec"];
        
        let currentPrice = keyPoints[0].price;

        for (let m = 0; m < 12; m++) {
            const daysInMonth = 30; // ç®€åŒ–ä¸ºæ¯æœˆ30ä¸ªäº¤æ˜“æ—¥æ–¹ä¾¿æ’ç‰ˆ
            const startDay = new Date(2025, m, 1).getDay(); // çœŸå®æ˜ŸæœŸå‡ 
            
            // è®¡ç®—æœ¬æœˆç›®æ ‡ä»·æ ¼å’Œæ¶¨å¹…éœ€æ±‚
            const startP = keyPoints[m].price;
            const endP = keyPoints[m+1].price;
            const totalChangeNeeded = endP - startP;
            const dailyStep = totalChangeNeeded / daysInMonth;

            let monthObj = {
                name: monthNames[m],
                days: [],
                startDay: startDay,
                avgPrice: (startP + endP) / 2
            };

            for (let d = 1; d <= daysInMonth; d++) {
                // åŸºç¡€è¶‹åŠ¿ + éšæœºæ³¢åŠ¨ (ç‰›å¸‚æ³¢åŠ¨å¤§)
                let noise = (Math.random() - 0.5) * (currentPrice * 0.015); 
                
                // 9æœˆå’Œ10æœˆæ˜¯å¤§æ¶¨æœˆä»½ï¼Œæ³¢åŠ¨æ›´å‰§çƒˆ
                if(m >= 8) noise *= 1.5; 

                // æ¯æ—¥ä»·æ ¼ = ä¸Šä¸€æ—¥ + è¶‹åŠ¿å¢é‡ + å™ªéŸ³
                let nextPrice = currentPrice + dailyStep + noise;
                
                // è®¡ç®—æ¶¨è·Œå¹…
                let changePct = ((nextPrice - currentPrice) / currentPrice) * 100;
                
                monthObj.days.push({
                    date: `2025-${(m+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`,
                    change: changePct,
                    price: Math.floor(nextPrice)
                });
                
                currentPrice = nextPrice;
            }
            yearData.push(monthObj);
        }

        // --- 3. 3Dä¸–ç•Œæ„å»º ---
        const clickableObjects = [];
        const redMat = new THREE.MeshStandardMaterial({ color: 0xff4d4f, roughness: 0.1, metalness: 0.1 });
        const greenMat = new THREE.MeshStandardMaterial({ color: 0x22c55e, roughness: 0.1, metalness: 0.1 });
        const baseMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
        
        const barSize = 1.6;
        const gap = 0.4;
        const cellSize = barSize + gap;
        const monthGapZ = 45; // å²›å±¿é—´è·

        yearData.forEach((month, mIndex) => {
            const group = new THREE.Group();
            const startZ = -mIndex * monthGapZ;

            // æœˆä»½åº•åº§ (å²›å±¿)
            const baseW = cellSize * 7 + 2;
            const baseD = cellSize * 6 + 2;
            const baseGeo = new THREE.BoxGeometry(baseW, 0.4, baseD);
            const base = new THREE.Mesh(baseGeo, baseMat);
            base.position.set(cellSize * 3, -0.2, cellSize * 2.5);
            base.receiveShadow = true;
            group.add(base);

            // è£…é¥°ï¼šå¦‚æœæ˜¯ç ´4000çš„10æœˆï¼ŒæŠŠåº•åº§å˜æˆé‡‘è‰²
            if (mIndex === 9) {
                base.material = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.5, roughness: 0.2 });
            }

            // æœˆä»½æ ‡é¢˜è´´å›¾
            const textTexture = createTextTexture(month.name, mIndex >= 8 ? '#d63031' : '#333'); // åæœŸæœˆä»½ç”¨çº¢è‰²æ ‡é¢˜
            const textMat = new THREE.MeshBasicMaterial({ map: textTexture, transparent: true });
            const textMesh = new THREE.Mesh(new THREE.PlaneGeometry(14, 3.5), textMat);
            textMesh.position.set(2, 0.5, -3); 
            textMesh.rotation.x = -Math.PI / 2;
            group.add(textMesh);

            // ä»·æ ¼æ ‡ç­¾ (æ˜¾ç¤ºè¯¥æœˆå¤§æ¦‚ä»·ä½)
            const priceTexture = createTextTexture(`$${Math.round(month.avgPrice)}`, '#888');
            const priceMesh = new THREE.Mesh(new THREE.PlaneGeometry(10, 2.5), new THREE.MeshBasicMaterial({ map: priceTexture, transparent: true }));
            priceMesh.position.set(12, 0.5, -3);
            priceMesh.rotation.x = -Math.PI / 2;
            group.add(priceMesh);

            // ç”ŸæˆæŸ±å­
            month.days.forEach((day, dIndex) => {
                const gridIndex = dIndex + month.startDay;
                const col = gridIndex % 7;
                const row = Math.floor(gridIndex / 7);

                // é«˜åº¦æ˜ å°„ï¼šç‰›å¸‚æœŸé—´æ¶¨å¹…å¯èƒ½å¾ˆå¤§ï¼Œé™åˆ¶ä¸€ä¸‹æœ€å¤§é«˜åº¦ä»¥å…ç©¿æ¨¡
                let h = Math.abs(day.change) * 3;
                if (h < 0.2) h = 0.2;
                
                const geo = new THREE.BoxGeometry(barSize, h, barSize);
                const mat = day.change >= 0 ? redMat : greenMat;
                const bar = new THREE.Mesh(geo, mat);

                bar.position.set(col * cellSize, h / 2, row * cellSize);
                bar.castShadow = true;
                bar.receiveShadow = true;
                
                bar.userData = { isBar: true, ...day };
                group.add(bar);
                clickableObjects.push(bar);
            });

            // æ”¾ç½®åˆ°ä¸–ç•Œåæ ‡
            group.position.set(-10, 0, startZ);
            scene.add(group);
        });

        // --- 4. é£æœºä¸ç‰¹æ•ˆ ---
        const planeGroup = new THREE.Group();
        // é‡‘è‰²æˆ˜æœº
        const bodyMat = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.9, roughness: 0.2 });
        const body = new THREE.Mesh(new THREE.ConeGeometry(0.8, 3.5, 16), bodyMat);
        body.rotation.x = -Math.PI / 2;
        const wing = new THREE.Mesh(new THREE.BoxGeometry(4.5, 0.1, 1.2), bodyMat);
        const tail = new THREE.Mesh(new THREE.BoxGeometry(1.5, 0.1, 0.8), bodyMat);
        tail.position.z = 1.5;
        
        // å¼•æ“ç²’å­å…‰æ•ˆ
        const glowGeo = new THREE.SphereGeometry(0.3);
        const glowMat = new THREE.MeshBasicMaterial({ color: 0x00ffff });
        const glow = new THREE.Mesh(glowGeo, glowMat);
        glow.position.z = 1.8;

        planeGroup.add(body, wing, tail, glow);
        planeGroup.position.set(0, 10, 20);
        scene.add(planeGroup);

        // --- 5. äº¤äº’æ§åˆ¶ ---
        let isFlying = true;
        let flightSpeed = 0.18; // é£è¡Œé€Ÿåº¦
        const totalDist = 12 * monthGapZ + 20;
        
        // ç›¸æœºæ§åˆ¶å™¨
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.enablePan = false;
        controls.target.set(0, 0, 0);

        window.toggleFlight = function() {
            isFlying = !isFlying;
            const btn = document.getElementById('toggleBtn');
            btn.innerText = isFlying ? "â¸ æš‚åœå·¡èˆª" : "â–¶ ç»§ç»­å·¡èˆª";
            btn.classList.toggle('stop', !isFlying);
        };

        window.resetCamera = function() {
            // é‡ç½®åˆ°é£æœºåä¸Šæ–¹
            const offset = new THREE.Vector3(0, 15, 25);
            camera.position.copy(planeGroup.position).add(offset);
            camera.lookAt(planeGroup.position);
        }

        // é¼ æ ‡ç‚¹å‡»æ‹¾å–
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let selectedObj = null;

        window.addEventListener('click', (e) => {
            if (e.target.closest('#controls')) return;

            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(clickableObjects);
            const tooltip = document.getElementById('tooltip');

            if (intersects.length > 0) {
                // é€‰ä¸­é«˜äº®
                if(selectedObj) selectedObj.material.emissive.setHex(0x000000);
                selectedObj = intersects[0].object;
                selectedObj.material.emissive.setHex(0x555555);

                const data = selectedObj.userData;
                
                // æ›´æ–°Tooltip
                tooltip.style.display = 'block';
                tooltip.style.left = e.clientX + 15 + 'px';
                tooltip.style.top = e.clientY + 15 + 'px';
                
                document.getElementById('tt-date').innerText = data.date;
                document.getElementById('tt-price').innerText = '$' + data.price.toLocaleString();
                const pEl = document.getElementById('tt-percent');
                pEl.innerText = (data.change >= 0 ? "+" : "") + data.change.toFixed(2) + "%";
                pEl.className = "percent " + (data.change >= 0 ? "txt-red" : "txt-green");

                // è‡ªåŠ¨æš‚åœä»¥ä¾¿æŸ¥çœ‹
                if(isFlying) toggleFlight();
            } else {
                tooltip.style.display = 'none';
                if(selectedObj) selectedObj.material.emissive.setHex(0x000000);
                selectedObj = null;
            }
        });

        // --- 6. åŠ¨ç”»å¾ªç¯ ---
        function animate() {
            requestAnimationFrame(animate);

            if (isFlying) {
                planeGroup.position.z -= flightSpeed;
                
                // ç®€å•çš„é£è¡Œå§¿æ€
                planeGroup.position.y = 12 + Math.sin(Date.now() * 0.0015) * 1.5;
                planeGroup.rotation.z = Math.sin(Date.now() * 0.001) * 0.15;

                // å¾ªç¯é£è¡Œ
                if (planeGroup.position.z < -totalDist) {
                    planeGroup.position.z = 20;
                }

                // ç›¸æœºæ™ºèƒ½è·Ÿéš
                const targetPos = planeGroup.position.clone();
                targetPos.y += 18;
                targetPos.z += 28;
                camera.position.lerp(targetPos, 0.08);
                camera.lookAt(planeGroup.position.x, 0, planeGroup.position.z - 15);
            } else {
                controls.target.lerp(planeGroup.position, 0.1);
                controls.update();
            }

            renderer.render(scene, camera);
        }

        // å¯åŠ¨è°ƒæ•´
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();

    </script>
</body>
</html>
