<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 Ë¥µÈáëÂ±ûÂ§úËà™¬∑ÊâãÊú∫ÂÆåÁæéÈÄÇÈÖçÁâà</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #0b0c10; font-family: 'Microsoft YaHei', sans-serif; touch-action: none; /* Á¶ÅÊ≠¢ÈªòËÆ§Ëß¶Êë∏Ë°å‰∏∫ */ }
        
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            z-index: 10;
        }

        /* È°∂ÈÉ®Èù¢Êùø */
        .top-panel { padding: 15px; pointer-events: auto; }
        .header-box {
            background: rgba(20, 20, 20, 0.9); padding: 10px 15px; border-radius: 12px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.1); border-left: 4px solid #ffd700; color: #fff;
            display: inline-block; max-width: 90%;
        }
        h1 { margin: 0; font-size: 18px; color: #ffd700; font-weight: 800; display: flex; align-items: center; gap: 8px;}
        .badge { background: #ffd700; color: #000; padding: 1px 6px; font-size: 10px; border-radius: 4px; }
        .sub-text { font-size: 12px; color: #aaa; margin-top: 4px; }
        
        /* ÊèêÁ§∫Ê°Ü */
        #tooltip {
            position: absolute; display: none;
            background: rgba(0, 0, 0, 0.95); color: #fff;
            padding: 12px; border-radius: 8px;
            box-shadow: 0 0 25px rgba(255,215,0,0.3);
            pointer-events: none; border: 1px solid #666;
            min-width: 140px; z-index: 100;
        }
        .metal-tag { padding: 2px 6px; border-radius: 4px; font-size: 12px; margin-bottom: 5px; font-weight: bold; color: #000; display: inline-block;}
        #tooltip .price { font-size: 20px; font-weight: bold; color: #ffd700; font-family: 'DIN Alternate', sans-serif; }
        .txt-red { color: #ff4d4f; } .txt-green { color: #00cc66; }
        
        .tag-Au { background-color: #ffd700; } .tag-Ag { background-color: #c0c0c0; }
        .tag-Pt { background-color: #e5e4e2; } .tag-Pd { background-color: #ced4da; }

        /* --- ÊâãÊú∫Á´ØËôöÊãüÊéßÂà∂Âô® --- */
        #mobile-controls {
            position: absolute; bottom: 20px; width: 100%; height: 160px;
            pointer-events: none; /* ËÆ©ÁÇπÂáªÁ©øÈÄèÁ©∫ÁôΩÂå∫Âüü */
            display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box;
        }
        
        /* ÂçÅÂ≠óÊñπÂêëÈîÆÂå∫Âüü */
        .d-pad {
            position: relative; width: 140px; height: 140px;
            pointer-events: auto; /* ÂÖÅËÆ∏Ëß¶Êë∏ */
        }
        .d-btn {
            position: absolute; width: 45px; height: 45px;
            background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px; backdrop-filter: blur(4px);
            display: flex; justify-content: center; align-items: center;
            font-size: 20px; color: #fff; user-select: none;
        }
        .d-btn:active { background: rgba(255, 215, 0, 0.5); border-color: #ffd700; }
        
        .btn-up { top: 0; left: 47.5px; }
        .btn-down { bottom: 0; left: 47.5px; }
        .btn-left { top: 47.5px; left: 0; }
        .btn-right { top: 47.5px; right: 0; }

        /* Âè≥‰æßÊìç‰ΩúÂå∫ */
        .action-area {
            display: flex; flex-direction: column; gap: 15px; align-items: flex-end;
            pointer-events: auto;
        }
        .round-btn {
            width: 60px; height: 60px; border-radius: 50%;
            border: none; color: white; font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: flex; justify-content: center; align-items: center; font-size: 14px;
        }
        .btn-turbo { background: #ff4d4f; font-size: 24px; }
        .btn-turbo:active { transform: scale(0.95); background: #ff7875; }
        .btn-pause { background: #1890ff; width: 50px; height: 50px; }

        /* ÁîµËÑëÁ´ØÈîÆÁõòÊèêÁ§∫ (ÊâãÊú∫ÈöêËóè) */
        .pc-hint { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            color: #666; font-size: 12px; background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 20px;
        }
        @media (max-width: 768px) {
            .pc-hint { display: none; }
            .month-nav { display: none; } /* ÊâãÊú∫Â±èÂ§™Â∞èÔºåÊöÇÊó∂ÈöêËóèÊúà‰ªΩÊù°Ôºå‰∏ìÊ≥®È£ûË°å */
        }
        @media (min-width: 769px) {
            #mobile-controls { display: none; } /* ÁîµËÑëÁ´ØÈöêËóèËôöÊãüÊâãÊüÑ */
        }

        /* Êúà‰ªΩÂØºËà™ (‰ªÖÂ§ßÂ±èÊòæÁ§∫) */
        .month-nav {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            pointer-events: auto; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 30px;
            display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; width: 80%;
        }
        .month-btn {
            background: #333; color: #ccc; border: 1px solid #555; padding: 5px 10px; cursor: pointer; border-radius: 4px;
        }
        .month-btn:hover { background: #ffd700; color: #000; }

    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="top-panel">
            <div class="header-box">
                <h1>üöÄ 2025 Ë¥µÈáëÂ±ûÂ§úËà™ <span class="badge">ÊâãÊú∫Áâà</span></h1>
                <p class="sub-text">Pt | Au | Ag | Pd ÂÖ®Âπ¥ÂÆûÁõò</p>
            </div>
        </div>

        <div id="tooltip">
            <span id="tt-metal" class="metal-tag tag-Au">Áé∞Ë¥ßÈªÑÈáë</span>
            <h3 id="tt-date">2025-01-01</h3>
            <div>Êî∂Áõò: <span id="tt-price" class="price">$2650</span></div>
            <span id="tt-percent" class="percent">-0.5%</span>
        </div>

        <div class="month-nav">
            <button class="month-btn" onclick="jumpToMonth(0)">1Êúà</button>
            <button class="month-btn" onclick="jumpToMonth(2)">3Êúà</button>
            <button class="month-btn" onclick="jumpToMonth(5)">6Êúà</button>
            <button class="month-btn" onclick="jumpToMonth(8)">9Êúà</button>
            <button class="month-btn" onclick="jumpToMonth(11)">12Êúà</button>
            <button class="month-btn" style="background:#444;" onclick="resetCamera()">üîÑ ÈáçÁΩÆ</button>
        </div>

        <div class="pc-hint">üíª ÁîµËÑëÊìç‰ΩúÔºöWASDÊéßÂà∂ | ShiftÂä†ÈÄü | Á©∫Ê†ºÊöÇÂÅú</div>

        <div id="mobile-controls">
            <div class="d-pad">
                <div class="d-btn btn-up" ontouchstart="setKey('Up', true)" ontouchend="setKey('Up', false)">‚ñ≤</div>
                <div class="d-btn btn-down" ontouchstart="setKey('Down', true)" ontouchend="setKey('Down', false)">‚ñº</div>
                <div class="d-btn btn-left" ontouchstart="setKey('Left', true)" ontouchend="setKey('Left', false)">‚óÄ</div>
                <div class="d-btn btn-right" ontouchstart="setKey('Right', true)" ontouchend="setKey('Right', false)">‚ñ∂</div>
            </div>
            
            <div class="action-area">
                <button class="round-btn btn-pause" onclick="toggleFlight()">‚è∏</button>
                <button class="round-btn btn-turbo" ontouchstart="setTurbo(true)" ontouchend="setTurbo(false)">üöÄ</button>
            </div>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const metals = [
            { id: 'Pt', name: 'Áé∞Ë¥ßÈìÇÈáë', color: '#e5e4e2' },
            { id: 'Au', name: 'Áé∞Ë¥ßÈªÑÈáë', color: '#ffd700' },
            { id: 'Ag', name: 'Áé∞Ë¥ßÁôΩÈì∂', color: '#c0c0c0' },
            { id: 'Pd', name: 'Áé∞Ë¥ßÈíØÈáë', color: '#8899a6' }
        ];
        const monthNames = ["1Êúà", "2Êúà", "3Êúà", "4Êúà", "5Êúà", "6Êúà", "7Êúà", "8Êúà", "9Êúà", "10Êúà", "11Êúà", "12Êúà"];
        
        // ÁúüÂÆûÊï∞ÊçÆ
        const rawData = {
            "Au": [ 
                [[2,2657.2,0],[3,2638.4,-0.71],[6,2636.0,-0.09],[7,2648.2,0.46],[8,2661.1,0.49],[9,2669.5,0.32],[10,2689.8,0.76],[13,2662.5,-1.01],[14,2676.9,0.54],[15,2695.7,0.70],[16,2713.7,0.67],[17,2702.1,-0.43],[20,2710.4,0.31],[21,2744.0,1.24],[22,2755.8,0.43],[23,2754.1,-0.06],[24,2770.0,0.58],[27,2739.8,-1.09],[28,2763.0,0.85],[29,2758.6,-0.16],[30,2793.5,1.26],[31,2798.1,0.17]],
                [[3,2814.1,0.57],[4,2841.4,0.97],[5,2866.2,0.87],[6,2855.8,-0.36],[7,2860.1,0.15],[10,2907.6,1.66],[11,2897.2,-0.36],[12,2904.0,0.23],[13,2927.3,0.80],[14,2882.1,-1.54],[17,2898.6,0.57],[18,2935.5,1.27],[19,2933.2,-0.08],[20,2939.0,0.20],[21,2935.0,-0.14],[24,2952.7,0.60],[25,2914.5,-1.29],[26,2916.0,0.05],[27,2876.5,-1.36],[28,2857.0,-0.68]],
                [[3,2891.4,1.20],[4,2916.6,0.87],[5,2918.7,0.07],[6,2911.0,-0.27],[7,2909.4,-0.06],[10,2888.5,-0.72],[11,2915.8,0.95],[12,2932.9,0.59],[13,2988.3,1.89],[14,2983.8,-0.15],[17,3000.4,0.56],[18,3034.3,1.13],[19,3046.8,0.41],[20,3044.3,-0.08],[21,3022.8,-0.71],[24,3011.4,-0.38],[25,3019.8,0.28],[26,3019.1,-0.02],[27,3055.5,1.21],[28,3084.3,0.94],[31,3122.9,1.25]],
                [[1,3113.6,-0.30],[2,3135.4,0.70],[3,3114.5,-0.67],[4,3037.3,-2.48],[7,2983.0,-1.79],[8,2982.5,-0.02],[9,3082.0,3.34],[10,3175.0,3.02],[11,3238.1,1.99],[14,3210.1,-0.86],[15,3229.9,0.62],[16,3342.5,3.49],[17,3326.8,-0.47],[21,3423.8,2.91],[22,3379.4,-1.30],[23,3287.9,-2.71],[24,3348.0,1.83],[25,3318.8,-0.87],[28,3343.6,0.75],[29,3316.6,-0.81],[30,3288.3,-0.85]],
                [[1,3238.4,-1.52],[2,3240.6,0.07],[5,3332.9,2.85],[6,3431.1,2.95],[7,3364.1,-1.95],[8,3305.5,-1.74],[9,3326.5,0.63],[12,3235.6,-2.73],[13,3249.5,0.43],[14,3176.6,-2.24],[15,3239.6,1.98],[16,3201.8,-1.17],[19,3229.2,0.86],[20,3289.3,1.86],[21,3314.4,0.76],[22,3294.5,-0.60],[23,3357.5,1.91],[26,3342.2,-0.46],[27,3300.5,-1.25],[28,3286.3,-0.43],[29,3317.8,0.96],[30,3288.6,-0.88]],
                [[2,3380.8,2.80],[3,3352.9,-0.83],[4,3371.9,0.57],[5,3351.9,-0.59],[6,3309.5,-1.27],[9,3325.0,0.47],[10,3322.7,-0.07],[11,3355.0,0.97],[12,3386.0,0.92],[13,3433.4,1.40],[16,3383.6,-1.45],[17,3387.0,0.10],[18,3368.5,-0.55],[19,3370.4,0.06],[20,3367.6,-0.08],[23,3367.6,0.00],[24,3322.6,-1.33],[25,3332.1,0.28],[26,3327.7,-0.13],[27,3273.3,-1.63],[30,3302.2,0.88]],
                [[1,3337.3,1.07],[2,3356.9,0.59],[3,3326.1,-0.92],[4,3336.9,0.33],[7,3336.4,-0.02],[8,3300.6,-1.07],[9,3313.0,0.38],[10,3323.3,0.31],[11,3354.8,0.95],[14,3342.8,-0.36],[15,3323.1,-0.59],[16,3346.0,0.69],[17,3338.9,-0.21],[18,3349.7,0.32],[21,3396.7,1.40],[22,3431.2,1.02],[23,3386.7,-1.30],[24,3368.1,-0.55],[25,3336.2,-0.95],[28,3314.2,-0.66],[29,3326.1,0.36],[30,3275.1,-1.53],[31,3289.7,0.45]],
                [[1,3362.6,2.22],[4,3372.3,0.29],[5,3380.5,0.24],[6,3368.8,-0.35],[7,3396.6,0.82],[8,3398.6,0.06],[11,3341.8,-1.67],[12,3347.6,0.18],[13,3355.2,0.22],[14,3334.9,-0.60],[15,3335.3,0.01],[18,3331.8,-0.10],[19,3315.5,-0.49],[20,3347.3,0.96],[21,3338.9,-0.25],[22,3371.2,0.97],[25,3365.6,-0.17],[26,3393.5,0.83],[27,3396.5,0.09],[28,3415.8,0.57],[29,3446.8,0.91]],
                [[1,3475.5,0.83],[2,3532.4,1.64],[3,3558.5,0.74],[4,3544.6,-0.39],[5,3586.0,1.17],[8,3636.0,1.39],[9,3624.2,-0.33],[10,3639.8,0.43],[11,3633.5,-0.17],[12,3642.6,0.25],[15,3678.9,1.00],[16,3689.6,0.29],[17,3658.9,-0.83],[18,3643.8,-0.41],[19,3684.7,1.12],[22,3745.8,1.66],[23,3763.0,0.46],[24,3735.8,-0.72],[25,3748.4,0.34],[26,3758.8,0.28],[29,3832.9,1.97],[30,3857.8,0.65]],
                [[1,3865.4,0.20],[2,3855.7,-0.25],[3,3885.7,0.78],[6,3959.0,1.89],[7,3984.3,0.64],[8,4040.4,1.41],[9,3976.0,-1.60],[10,4017.8,1.05],[13,4110.0,2.29],[14,4141.5,0.77],[15,4206.6,1.57],[16,4326.5,2.85],[17,4251.4,-1.73],[20,4355.7,2.45],[21,4124.4,-5.31],[22,4097.9,-0.64],[23,4126.5,0.70],[24,4111.6,-0.36],[27,3982.0,-3.15],[28,3951.9,-0.75],[29,3929.7,-0.56],[30,4024.5,2.41],[31,4002.7,-0.54]],
                [[3,4001.1,-0.04],[4,3932.0,-1.73],[5,3979.8,1.22],[6,3976.9,-0.07],[7,4000.3,0.59],[10,4115.6,2.88],[11,4125.5,0.24],[12,4194.6,1.68],[13,4170.9,-0.57],[14,4082.2,-2.13],[17,4044.5,-0.92],[18,4066.6,0.55],[19,4077.0,0.26],[20,4076.6,-0.01],[21,4064.3,-0.30],[24,4134.7,1.73],[25,4131.9,-0.07],[26,4162.6,0.74],[27,4156.9,-0.14],[28,4218.6,1.48]],
                [[1,4231.3,0.30],[2,4205.7,-0.60],[3,4202.9,-0.07],[4,4207.9,0.12],[5,4197.4,-0.25],[8,4189.9,-0.18],[9,4206.6,0.40],[10,4227.6,0.50],[11,4279.1,1.22],[12,4299.3,0.47],[15,4304.0,0.11],[16,4302.8,-0.03],[17,4337.3,0.80],[18,4331.2,-0.14],[19,4341.1,0.23],[22,4444.0,2.37],[23,4484.9,0.92],[24,4479.4,-0.12],[26,4532.5,1.19]]
            ],
            "Ag": [ 
                [[2,29.52,0],[3,29.60,0.26],[6,29.93,1.14],[7,30.03,0.30],[8,30.08,0.17],[9,30.10,0.07],[10,30.38,0.94],[13,29.60,-2.56],[14,29.87,0.90],[15,30.65,2.63],[16,30.79,0.45],[17,30.32,-1.52],[20,30.47,0.48],[21,30.77,1.00],[22,30.79,0.04],[23,30.39,-1.30],[24,30.52,0.44],[27,30.18,-1.12],[28,30.39,0.71],[29,30.80,1.35],[30,31.63,2.70],[31,31.30,-1.06]],
                [[3,31.55,0.81],[4,32.12,1.79],[5,32.28,0.51],[6,32.17,-0.33],[7,31.77,-1.26],[10,32.02,0.80],[11,31.81,-0.67],[12,32.21,1.27],[13,32.33,0.37],[14,32.11,-0.68],[17,32.36,0.77],[18,32.86,1.55],[19,32.69,-0.52],[20,32.95,0.80],[21,32.42,-1.61],[24,32.33,-0.29],[25,31.73,-1.85],[26,31.86,0.41],[27,31.23,-1.97],[28,31.12,-0.37]],
                [[3,31.66,1.75],[4,31.95,0.91],[5,32.63,2.14],[6,32.63,-0.02],[7,32.51,-0.36],[10,32.06,-1.37],[11,32.93,2.70],[12,33.22,0.90],[13,33.85,1.90],[14,33.83,-0.06],[17,33.85,0.06],[18,34.00,0.43],[19,33.80,-0.60],[20,33.58,-0.65],[21,33.02,-1.66],[24,32.99,-0.08],[25,33.72,2.20],[26,33.62,-0.29],[27,34.39,2.29],[28,34.11,-0.81],[31,34.07,-0.12]],
                [[1,33.68,-1.15],[2,33.90,0.65],[3,31.84,-6.06],[4,29.59,-7.08],[7,30.03,1.48],[8,29.81,-0.71],[9,30.97,3.88],[10,31.21,0.78],[11,32.28,3.43],[14,32.34,0.17],[15,32.30,-0.10],[16,32.75,1.38],[17,32.55,-0.61],[21,32.65,0.31],[22,32.49,-0.48],[23,33.56,3.27],[24,33.57,0.04],[25,33.08,-1.45],[28,33.14,0.17],[29,32.92,-0.65],[30,32.61,-0.95]],
                [[1,32.41,-0.60],[2,32.00,-1.27],[5,32.48,1.50],[6,33.21,2.25],[7,32.44,-2.32],[8,32.45,0.02],[9,32.72,0.84],[12,32.58,-0.43],[13,32.89,0.98],[14,32.20,-2.10],[15,32.63,1.33],[16,32.28,-1.08],[19,32.34,0.19],[20,33.06,2.24],[21,33.38,0.95],[22,33.04,-1.02],[23,33.48,1.34],[26,33.48,-0.01],[27,33.24,-0.70],[28,32.96,-0.86],[29,33.30,1.05],[30,32.98,-0.98]],
                [[2,34.73,5.32],[3,34.50,-0.67],[4,34.46,-0.12],[5,35.63,3.40],[6,35.98,0.98],[9,36.74,2.13],[10,36.52,-0.60],[11,36.22,-0.85],[12,36.34,0.34],[13,36.29,-0.13],[16,36.29,0.00],[17,37.06,2.11],[18,36.71,-0.95],[19,36.37,-0.91],[20,35.97,-1.10],[23,36.09,0.31],[24,35.90,-0.51],[25,36.25,0.97],[26,36.65,1.09],[27,35.96,-1.88],[30,36.09,0.37]],
                [[1,36.01,-0.21],[2,36.55,1.48],[3,36.83,0.77],[4,36.89,0.16],[7,36.73,-0.41],[8,36.72,-0.04],[9,36.38,-0.94],[10,36.99,1.70],[11,38.39,3.77],[14,38.11,-0.72],[15,37.69,-1.12],[16,37.85,0.44],[17,38.14,0.75],[18,38.15,0.03],[21,38.90,1.97],[22,39.27,0.95],[23,39.22,-0.12],[24,39.03,-0.48],[25,38.14,-2.29],[28,38.15,0.04],[29,38.19,0.10],[30,37.10,-2.87],[31,36.66,-1.16]],
                [[1,37.02,0.97],[4,37.40,1.03],[5,37.78,1.03],[6,37.74,-0.12],[7,38.26,1.38],[8,38.34,0.21],[11,37.59,-1.96],[12,37.89,0.81],[13,38.47,1.53],[14,37.98,-1.29],[15,37.99,0.03],[18,38.01,0.06],[19,37.38,-1.66],[20,37.86,1.28],[21,38.12,0.70],[22,38.89,2.01],[25,38.56,-0.85],[26,38.60,0.12],[27,38.56,-0.11],[28,39.02,1.18],[29,39.69,1.72]],
                [[1,40.67,2.48],[2,40.82,0.36],[3,41.19,0.91],[4,40.65,-1.30],[5,40.97,0.77],[8,41.34,0.90],[9,40.86,-1.16],[10,41.14,0.70],[11,41.50,0.87],[12,42.16,1.59],[15,42.67,1.20],[16,42.55,-0.27],[17,41.64,-2.14],[18,41.80,0.38],[19,43.06,3.02],[22,43.99,2.16],[23,44.01,0.05],[24,43.89,-0.29],[25,45.13,2.83],[26,46.03,2.00],[29,46.91,1.90],[30,46.65,-0.54]],
                [[1,47.28,1.34],[2,46.94,-0.73],[3,47.98,2.22],[6,48.49,1.06],[7,47.81,-1.40],[8,48.86,2.20],[9,49.21,0.71],[10,50.13,1.87],[13,52.33,4.39],[14,51.41,-1.76],[15,53.05,3.19],[16,54.14,2.06],[17,51.86,-4.21],[20,52.39,1.01],[21,48.66,-7.11],[22,48.44,-0.46],[23,48.85,0.86],[24,48.62,-0.47],[27,46.97,-3.41],[28,47.03,0.13],[29,47.49,0.98],[30,48.89,2.94],[31,48.66,-0.48]],
                [[3,48.07,-1.21],[4,47.12,-1.97],[5,47.97,1.80],[6,48.01,0.07],[7,48.33,0.67],[10,50.49,4.48],[11,51.21,1.43],[12,53.26,3.99],[13,52.33,-1.74],[14,50.52,-3.47],[17,50.18,-0.67],[18,50.68,0.99],[19,51.29,1.21],[20,50.64,-1.26],[21,49.99,-1.29],[24,51.35,2.72],[25,51.44,0.18],[26,53.33,3.67],[27,53.37,0.09],[28,56.40,5.66]],
                [[1,57.96,2.76],[2,58.45,0.85],[3,58.47,0.04],[4,57.09,-2.35],[5,58.29,2.10],[8,58.13,-0.27],[9,60.65,4.33],[10,61.73,1.78],[11,63.55,2.95],[12,61.92,-2.57],[15,64.03,3.40],[16,63.68,-0.54],[17,66.25,4.03],[18,65.43,-1.24],[19,67.05,2.48],[22,69.05,2.98],[23,71.41,3.42],[24,71.81,0.56],[26,79.33,10.47]]
            ],
            "Pt": [
                [[2,921.8,0],[3,934.3,1.36],[6,934.0,-0.03],[7,946.9,1.38],[8,952.6,0.60],[9,955.4,0.29],[10,958.0,0.27],[13,949.9,-0.85],[14,941.0,-0.94],[15,936.7,-0.46],[16,933.2,-0.37],[17,936.3,0.33],[20,941.2,0.52],[21,943.2,0.21],[22,948.8,0.59],[23,941.3,-0.79],[24,945.7,0.47],[27,945.5,-0.02],[28,940.4,-0.54],[29,944.7,0.46],[30,964.6,2.11],[31,975.5,1.13]],
                [[3,964.6,-1.12],[4,964.2,-0.04],[5,976.1,1.23],[6,983.5,0.76],[7,968.0,-1.58],[10,987.2,1.98],[11,983.2,-0.41],[12,993.2,1.02],[13,997.4,0.42],[14,972.7,-2.48],[17,980.1,0.76],[18,983.7,0.37],[19,973.8,-1.01],[20,979.3,0.56],[21,966.9,-1.27],[24,967.7,0.08],[25,972.3,0.48],[26,966.5,-0.60],[27,947.9,-1.92],[28,947.3,-0.06]],
                [[3,952.9,0.59],[4,962.2,0.98],[5,966.1,0.41],[6,967.7,0.17],[7,960.4,-0.75],[10,958.3,-0.22],[11,979.6,2.22],[12,984.6,0.51],[13,994.4,1.00],[14,991.0,-0.34],[17,999.6,0.87],[18,1001.6,0.20],[19,996.6,-0.50],[20,983.1,-1.35],[21,976.7,-0.65],[24,974.5,-0.23],[25,978.4,0.40],[26,975.4,-0.31],[27,985.4,1.03],[28,983.6,-0.18],[31,994.5,1.11]],
                [[1,985.3,-0.93],[2,970.5,-1.50],[3,948.7,-2.25],[4,918.7,-3.16],[7,914.4,-0.47],[8,920.0,0.61],[9,933.7,1.49],[10,933.3,-0.04],[11,939.9,0.71],[14,950.4,1.12],[15,959.6,0.97],[16,968.6,0.94],[17,966.0,-0.27],[21,962.2,-0.39],[22,953.1,-0.95],[23,973.2,2.11],[24,974.0,0.08],[25,970.3,-0.38],[28,987.3,1.75],[29,979.1,-0.83],[30,967.7,-1.16]],
                [[1,966.9,-0.08],[2,961.1,-0.60],[5,961.0,-0.01],[6,984.3,2.42],[7,976.9,-0.75],[8,980.0,0.32],[9,995.1,1.54],[12,980.3,-1.49],[13,990.0,0.99],[14,982.8,-0.73],[15,991.5,0.89],[16,987.2,-0.43],[19,997.4,1.03],[20,1052.9,5.56],[21,1074.8,2.08],[22,1078.7,0.36],[23,1091.8,1.21],[26,1087.9,-0.36],[27,1083.7,-0.39],[28,1080.5,-0.30],[29,1084.2,0.34],[30,1055.5,-2.65]],
                [[2,1066.4,1.03],[3,1077.5,1.04],[4,1090.8,1.23],[5,1138.8,4.40],[6,1165.9,2.38],[9,1218.0,4.47],[10,1217.4,-0.05],[11,1259.6,3.47],[12,1296.3,2.91],[13,1226.5,-5.38],[16,1246.3,1.61],[17,1261.6,1.23],[18,1316.7,4.37],[19,1304.9,-0.90],[20,1262.2,-3.27],[23,1295.2,2.61],[24,1317.5,1.72],[25,1353.1,2.70],[26,1421.2,5.03],[27,1337.3,-5.90],[30,1358.3,1.57]],
                [[1,1354.7,-0.27],[2,1421.4,4.92],[3,1375.3,-3.24],[4,1394.6,1.40],[7,1368.8,-1.85],[8,1370.4,0.12],[9,1350.4,-1.46],[10,1363.1,0.94],[11,1397.0,2.49],[14,1365.4,-2.26],[15,1364.3,-0.08],[16,1418.2,3.95],[17,1463.9,3.22],[18,1426.0,-2.59],[21,1448.6,1.58],[22,1442.3,-0.43],[23,1418.6,-1.64],[24,1414.6,-0.28],[25,1407.0,-0.54],[28,1395.0,-0.85],[29,1389.8,-0.37],[30,1309.8,-5.76],[31,1292.7,-1.31]],
                [[1,1317.3,1.90],[4,1327.9,0.80],[5,1320.7,-0.54],[6,1335.4,1.11],[7,1339.2,0.28],[8,1329.4,-0.73],[11,1326.8,-0.20],[12,1342.2,1.16],[13,1343.5,0.10],[14,1355.4,0.89],[15,1336.8,-1.37],[18,1330.9,-0.44],[19,1310.0,-1.57],[20,1335.6,1.95],[21,1353.8,1.36],[22,1358.4,0.34],[25,1343.9,-1.07],[26,1352.4,0.63],[27,1346.3,-0.45],[28,1359.2,0.96],[29,1366.1,0.51]],
                [[1,1405.7,2.90],[2,1408.2,0.18],[3,1408.5,0.02],[4,1374.1,-2.44],[5,1372.7,-0.10],[8,1384.3,0.85],[9,1373.3,-0.79],[10,1391.2,1.30],[11,1383.6,-0.55],[12,1400.1,1.19],[15,1404.4,0.31],[16,1396.4,-0.57],[17,1365.6,-2.21],[18,1383.4,1.30],[19,1402.4,1.37],[22,1412.7,0.73],[23,1475.3,4.43],[24,1471.1,-0.28],[25,1521.2,3.41],[26,1575.9,3.60],[29,1598.6,1.44],[30,1571.7,-1.68]],
                [[1,1566.3,-0.34],[2,1575.3,0.57],[3,1603.0,1.76],[6,1621.9,1.18],[7,1625.9,0.25],[8,1654.6,1.77],[9,1618.4,-2.19],[10,1597.5,-1.29],[13,1624.4,1.68],[14,1629.7,0.33],[15,1662.9,2.04],[16,1714.8,3.12],[17,1605.6,-6.37],[20,1628.3,1.41],[21,1544.3,-5.16],[22,1624.1,5.17],[23,1626.9,0.17],[24,1601.1,-1.59],[27,1585.9,-0.95],[28,1586.2,0.02],[29,1590.4,0.26],[30,1599.9,0.60],[31,1569.5,-1.90]],
                [[3,1567.6,-0.12],[4,1539.0,-1.82],[5,1561.2,1.44],[6,1528.0,-2.13],[7,1544.5,1.08],[10,1574.1,1.91],[11,1579.9,0.37],[12,1616.7,2.33],[13,1585.7,-1.92],[14,1539.1,-2.94],[17,1535.2,-0.25],[18,1530.1,-0.33],[19,1546.2,1.05],[20,1518.4,-1.80],[21,1512.0,-0.42],[24,1553.7,2.76],[25,1552.9,-0.05],[26,1588.3,2.28],[27,1608.7,1.28],[28,1668.5,3.72]],
                [[1,1663.2,-0.32],[2,1640.5,-1.36],[3,1672.5,1.95],[4,1641.7,-1.84],[5,1635.0,-0.41],[8,1651.4,1.00],[9,1688.9,2.27],[10,1655.2,-2.00],[11,1696.0,2.46],[12,1742.3,2.73],[15,1785.3,2.47],[16,1834.6,2.76],[17,1906.2,3.90],[18,1920.9,0.77],[19,1957.7,1.92],[22,2106.7,7.61],[23,2285.0,8.46],[24,2253.0,-1.40],[26,2459.5,9.17]]
            ],
            "Pd": [ 
                [[2,911.4,0],[3,924.4,1.42],[6,922.1,-0.24],[7,928.0,0.64],[8,926.1,-0.20],[9,927.7,0.17],[10,942.6,1.60],[13,942.6,0.01],[14,939.8,-0.30],[15,963.4,2.50],[16,954.4,-0.93],[17,945.8,-0.90],[20,945.9,0.01],[21,962.4,1.75],[22,980.9,1.93],[23,990.3,0.95],[24,980.9,-0.95],[27,962.3,-1.89],[28,955.0,-0.76],[29,961.3,0.66],[30,986.1,2.58],[31,1010.4,2.46]],
                [[3,1011.3,0.10],[4,992.2,-1.89],[5,993.7,0.15],[6,982.3,-1.15],[7,966.3,-1.63],[10,978.7,1.29],[11,978.5,-0.03],[12,972.9,-0.57],[13,996.1,2.39],[14,962.2,-3.40],[17,974.3,1.26],[18,984.6,1.05],[19,972.3,-1.25],[20,979.4,0.73],[21,965.5,-1.42],[24,942.3,-2.41],[25,929.9,-1.32],[26,926.8,-0.32],[27,918.3,-0.92],[28,917.7,-0.07]],
                [[3,936.8,2.08],[4,947.1,1.10],[5,942.8,-0.45],[6,941.8,-0.11],[7,945.1,0.36],[10,938.6,-0.69],[11,943.6,0.53],[12,950.5,0.74],[13,959.9,0.99],[14,962.2,0.24],[17,968.1,0.61],[18,966.8,-0.13],[19,959.7,-0.74],[20,950.1,-1.00],[21,954.3,0.45],[24,950.2,-0.43],[25,957.3,0.75],[26,966.0,0.90],[27,976.5,1.09],[28,968.9,-0.78],[31,989.6,2.14]],
                [[1,981.8,-0.80],[2,972.2,-0.97],[3,929.2,-4.43],[4,913.3,-1.71],[7,908.8,-0.49],[8,905.5,-0.37],[9,920.6,1.67],[10,917.7,-0.32],[11,914.8,-0.31],[14,951.4,4.00],[15,972.1,2.17],[16,969.1,-0.32],[17,960.0,-0.93],[21,934.0,-2.70],[22,929.3,-0.51],[23,937.5,0.89],[24,947.3,1.04],[25,939.7,-0.80],[28,947.5,0.82],[29,936.5,-1.15],[30,942.5,0.64]],
                [[1,942.7,0.02],[2,950.3,0.81],[5,942.7,-0.80],[6,973.8,3.30],[7,963.1,-1.10],[8,970.9,0.81],[9,975.2,0.44],[12,947.5,-2.84],[13,954.3,0.72],[14,952.4,-0.20],[15,959.9,0.78],[16,960.0,0.02],[19,973.5,1.40],[20,1016.0,4.37],[21,1024.0,0.79],[22,1007.0,-1.66],[23,995.6,-1.13],[26,984.4,-1.12],[27,976.6,-0.80],[28,960.1,-1.69],[29,975.5,1.61],[30,969.8,-0.58]],
                [[2,992.4,2.33],[3,1009.9,1.76],[4,999.4,-1.04],[5,1005.4,0.60],[6,1044.8,3.92],[9,1075.5,2.94],[10,1060.0,-1.44],[11,1071.1,1.04],[12,1061.0,-0.94],[13,1029.3,-2.99],[16,1029.7,0.03],[17,1051.6,2.13],[18,1047.3,-0.41],[19,1052.0,0.45],[20,1045.8,-0.58],[23,1075.4,2.83],[24,1063.8,-1.08],[25,1067.0,0.30],[26,1132.8,6.16],[27,1130.3,-0.22],[30,1106.0,-2.15]],
                [[1,1102.5,-0.32],[2,1159.0,5.12],[3,1137.0,-1.90],[4,1131.6,-0.47],[7,1108.4,-2.05],[8,1108.2,-0.02],[9,1106.3,-0.17],[10,1135.9,2.67],[11,1201.1,5.74],[14,1190.5,-0.88],[15,1198.5,0.67],[16,1234.5,3.00],[17,1281.0,3.77],[18,1255.0,-2.03],[21,1255.1,0.01],[22,1272.5,1.38],[23,1275.4,0.23],[24,1234.2,-3.23],[25,1216.0,-1.47],[28,1231.1,1.24],[29,1251.8,1.68],[30,1213.0,-3.11],[31,1191.8,-1.74]],
                [[1,1205.4,1.14],[4,1205.5,0.01],[5,1180.0,-2.12],[6,1143.5,-3.09],[7,1160.0,1.44],[8,1123.0,-3.19],[11,1144.0,1.87],[12,1128.8,-1.33],[13,1133.5,0.41],[14,1147.3,1.22],[15,1114.4,-2.87],[18,1112.0,-0.21],[19,1109.8,-0.20],[20,1113.2,0.30],[21,1111.9,-0.12],[22,1125.6,1.24],[25,1094.9,-2.72],[26,1100.6,0.52],[27,1089.9,-0.97],[28,1106.3,1.50],[29,1104.1,-0.20]],
                [[1,1134.5,2.75],[2,1137.5,0.26],[3,1141.0,0.31],[4,1125.5,-1.36],[5,1108.9,-1.48],[8,1138.0,2.63],[9,1143.0,0.44],[10,1175.5,2.84],[11,1191.0,1.32],[12,1196.1,0.43],[15,1199.0,0.24],[16,1182.5,-1.38],[17,1158.0,-2.07],[18,1162.5,0.39],[19,1153.5,-0.77],[22,1181.5,2.43],[23,1220.5,3.30],[24,1203.0,-1.43],[25,1256.7,4.46],[26,1268.3,0.92],[29,1270.5,0.18],[30,1257.4,-1.03]],
                [[1,1254.5,-0.23],[2,1253.0,-0.12],[3,1262.0,0.72],[6,1322.5,4.80],[7,1349.5,2.04],[8,1449.0,7.37],[9,1419.5,-2.04],[10,1417.0,-0.18],[13,1479.0,4.38],[14,1519.0,2.70],[15,1547.0,1.84],[16,1620.6,4.76],[17,1468.2,-9.40],[20,1501.5,2.27],[21,1405.5,-6.39],[22,1457.5,3.70],[23,1454.0,-0.24],[24,1416.0,-2.61],[27,1401.0,-1.06],[28,1399.0,-0.14],[29,1395.5,-0.25],[30,1450.5,3.94],[31,1436.5,-0.97]],
                [[3,1444.0,0.52],[4,1402.5,-2.87],[5,1421.0,1.32],[6,1378.5,-2.99],[7,1381.5,0.22],[10,1413.5,2.32],[11,1448.0,2.44],[12,1467.5,1.35],[13,1433.5,-2.32],[14,1400.2,-2.32],[17,1396.0,-0.30],[18,1398.5,0.18],[19,1387.7,-0.78],[20,1386.5,-0.08],[21,1377.5,-0.65],[24,1400.0,1.63],[25,1391.0,-0.64],[26,1426.5,2.55],[27,1431.3,0.33],[28,1448.2,1.18]],
                [[1,1424.8,-1.61],[2,1465.6,2.86],[3,1461.0,-0.31],[4,1456.1,-0.34],[5,1457.1,0.07],[8,1475.0,1.23],[9,1507.0,2.17],[10,1476.5,-2.02],[11,1492.0,1.05],[12,1490.3,-0.11],[15,1572.5,5.51],[16,1606.0,2.13],[17,1646.5,2.52],[18,1700.0,3.25],[19,1712.0,0.71],[22,1766.0,3.15],[23,1858.0,5.21],[24,1723.5,-7.24],[26,1925.0,11.69]]
            ]
        };

        function getMetalData(metalId) {
            const data = [];
            const yearlyData = rawData[metalId];
            
            for (let m = 0; m < 12; m++) {
                const monthRaw = yearlyData[m] || [];
                const startDay = new Date(2025, m, 1).getDay(); 
                
                const days = monthRaw.map(item => ({
                    date: `2025-${(m+1).toString().padStart(2,'0')}-${item[0].toString().padStart(2,'0')}`,
                    price: item[1].toFixed(2), 
                    change: item[2],           
                    dayOfMonth: item[0]        
                }));

                data.push({
                    monthName: monthNames[m],
                    days: days,
                    startDay: startDay
                });
            }
            return data;
        }

        const fullData = {};
        metals.forEach(metal => {
            fullData[metal.id] = getMetalData(metal.id);
        });

        function createTextTexture(text, size=60, color='#ffffff') {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'rgba(0,0,0,0)';
            ctx.clearRect(0,0,512,128);
            ctx.shadowColor = "rgba(0,0,0,0.8)";
            ctx.shadowBlur = 6;
            ctx.shadowOffsetX = 3;
            ctx.shadowOffsetY = 3;
            ctx.font = `bold ${size}px "Microsoft YaHei", sans-serif`;
            ctx.fillStyle = color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, 256, 64);
            return new THREE.CanvasTexture(canvas);
        }

        // --- 2. Âú∫ÊôØÂàùÂßãÂåñ ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0b0c10); 
        scene.fog = new THREE.Fog(0x0b0c10, 50, 180);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 2000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x222222, 0.8);
        scene.add(hemiLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(50, 100, 50);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 4096;
        dirLight.shadow.mapSize.height = 4096;
        scene.add(dirLight);

        // --- 3. ÊûÑÂª∫ 3D ‰∏ñÁïå ---
        const clickableObjects = [];
        const redMat = new THREE.MeshStandardMaterial({ color: 0xff4d4f, roughness: 0.2 });
        const greenMat = new THREE.MeshStandardMaterial({ color: 0x00b894, roughness: 0.2 });
        const baseMat = new THREE.MeshStandardMaterial({ color: 0x222222, roughness: 0.8 });

        const barSize = 1.2;
        const gap = 0.3;
        const cellSize = barSize + gap;
        const monthGapZ = 45;
        const laneGapX = 25;

        for(let m=0; m<12; m++) {
            const labelTex = createTextTexture(monthNames[m], 70, '#ffffff');
            const labelMat = new THREE.MeshBasicMaterial({ map: labelTex, transparent: true });
            const labelMesh = new THREE.Mesh(new THREE.PlaneGeometry(16, 4), labelMat);
            const centerX = (metals.length - 1) * laneGapX / 2; 
            labelMesh.position.set(centerX, 0.5, -m * monthGapZ - 5);
            labelMesh.rotation.x = -Math.PI / 2;
            scene.add(labelMesh);

            metals.forEach((metal, metalIdx) => {
                const monthData = fullData[metal.id][m];
                const group = new THREE.Group();
                const posX = metalIdx * laneGapX;
                const posZ = -m * monthGapZ;

                const base = new THREE.Mesh(new THREE.BoxGeometry(cellSize * 7 + 1, 0.2, cellSize * 6 + 1), baseMat);
                base.position.set(cellSize * 3, -0.1, cellSize * 2.5);
                base.receiveShadow = true;
                group.add(base);

                if(m === 0) {
                    const nameTex = createTextTexture(metal.name, 50, metal.color);
                    const nameMesh = new THREE.Mesh(new THREE.PlaneGeometry(12, 3), new THREE.MeshBasicMaterial({ map: nameTex, transparent: true }));
                    nameMesh.position.set(cellSize * 3, 2, -5);
                    nameMesh.rotation.x = -Math.PI / 6; 
                    group.add(nameMesh);
                }

                monthData.days.forEach((day) => {
                    const gridIndex = (day.dayOfMonth - 1) + monthData.startDay;
                    const col = gridIndex % 7;
                    const row = Math.floor(gridIndex / 7);
                    
                    let h = Math.abs(day.change) * 4; 
                    if(h < 0.2) h = 0.2;
                    if(h > 30) h = 30; 

                    const bar = new THREE.Mesh(new THREE.BoxGeometry(barSize, h, barSize), day.change >= 0 ? redMat : greenMat);
                    bar.position.set(col * cellSize, h / 2, row * cellSize);
                    bar.castShadow = true;
                    bar.receiveShadow = true;
                    bar.userData = { ...day, metalName: metal.name, metalId: metal.id }; 
                    group.add(bar);
                    clickableObjects.push(bar);
                });
                group.position.set(posX - 5, 0, posZ); 
                scene.add(group);
            });
        }

        // --- 4. È£ûÊú∫‰∏éHUD ---
        const planeGroup = new THREE.Group();
        const body = new THREE.Mesh(new THREE.ConeGeometry(0.6, 2.5, 16), new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 0.8 }));
        body.rotation.x = -Math.PI / 2;
        const wing = new THREE.Mesh(new THREE.BoxGeometry(5, 0.1, 1), new THREE.MeshStandardMaterial({ color: 0xd63031, emissive: 0x550000 })); 
        planeGroup.add(body, wing);
        const engineLight = new THREE.PointLight(0x00ffff, 1, 10);
        engineLight.position.set(0, 0, 2);
        planeGroup.add(engineLight);

        const startCenterX = (metals.length - 1) * laneGapX / 2;
        planeGroup.position.set(startCenterX, 35, 20); 
        scene.add(planeGroup);

        const hudLabels = [];
        metals.forEach((metal, idx) => {
            const posX = idx * laneGapX - 5 + (cellSize * 3); 
            const hudTex = createTextTexture(metal.name, 80, metal.color); 
            const hudMat = new THREE.MeshBasicMaterial({ map: hudTex, transparent: true, opacity: 0.95 });
            const hudMesh = new THREE.Mesh(new THREE.PlaneGeometry(16, 4), hudMat);
            hudMesh.position.set(posX, 12, 0); 
            scene.add(hudMesh);
            hudLabels.push({ mesh: hudMesh, xOffset: posX });
        });

        // --- 5. ‰∫§‰∫í‰∏éÊéßÂà∂ ---
        let isFlying = true;
        let baseSpeed = 0.2;
        let turboSpeed = 1.0; // Âä†ÈÄüÂÄçÁéá
        let currentSpeed = baseSpeed;
        const totalDist = 12 * monthGapZ + 20;

        const keys = { Left: false, Right: false, Up: false, Down: false, Turbo: false };
        let planeVelocityX = 0;
        let planeVelocityY = 0;
        const maxVel = 0.8;
        const acceleration = 0.05;
        const friction = 0.92;
        const minX = -10; 
        const maxX = (metals.length - 1) * laneGapX + 10;
        const minY = 5; 
        const maxY = 60;

        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') keys.Left = true;
            if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') keys.Right = true;
            if (e.key === 'ArrowUp' || e.key === 'w' || e.key === 'W') keys.Up = true;
            if (e.key === 'ArrowDown' || e.key === 's' || e.key === 'S') keys.Down = true;
            if (e.key === 'Shift') setTurbo(true);
            if (e.code === 'Space') toggleFlight();
        });
        window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') keys.Left = false;
            if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') keys.Right = false;
            if (e.key === 'ArrowUp' || e.key === 'w' || e.key === 'W') keys.Up = false;
            if (e.key === 'ArrowDown' || e.key === 's' || e.key === 'S') keys.Down = false;
            if (e.key === 'Shift') setTurbo(false);
        });

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.enablePan = false;
        controls.enableRotate = false; // Á¶ÅÁî®Èº†Ê†áÊóãËΩ¨ÔºÅ
        controls.target.set(startCenterX, 0, -20);

        window.toggleFlight = function() {
            isFlying = !isFlying;
            const btn = document.getElementById('toggleBtn');
            btn.innerText = isFlying ? "‚è∏ ÊöÇÂÅúÈ£ûË°å" : "‚ñ∂ ÁªßÁª≠È£ûË°å";
            btn.classList.toggle('stop', !isFlying);
            
            // ÊöÇÂÅúÊó∂ÂêØÁî®ÊóãËΩ¨ÔºåÈ£ûË°åÊó∂Á¶ÅÁî®
            controls.enableRotate = !isFlying;
        };

        window.setTurbo = function(active) {
            keys.Turbo = active;
            const btn = document.getElementById('turboBtn');
            if(active) {
                currentSpeed = turboSpeed;
                btn.style.transform = "scale(1.1)";
                btn.style.filter = "brightness(1.5)";
            } else {
                currentSpeed = baseSpeed;
                btn.style.transform = "scale(1)";
                btn.style.filter = "brightness(1)";
            }
        };

        window.jumpToMonth = function(monthIndex) {
            // ËÆ°ÁÆóÁõÆÊ†áZÂùêÊ†á (-m * 45)
            const targetZ = -monthIndex * monthGapZ + 10;
            
            // Áû¨ÁßªÈ£ûÊú∫
            planeGroup.position.z = targetZ;
            
            // Á®çÂæÆÈáçÁΩÆ‰∏Ä‰∏ãÁâ©ÁêÜÈÄüÂ∫¶ÔºåÈò≤Ê≠¢Áû¨ÁßªÂêé‰π±È£ò
            planeVelocityX = 0;
            planeVelocityY = 0;
            planeGroup.position.x = startCenterX; // ÂõûÂà∞‰∏≠Èó¥Ë∑ëÈÅì
            planeGroup.position.y = 35; // ÂõûÂà∞ÂÆâÂÖ®È´òÂ∫¶

            // Áû¨ÁßªÁõ∏Êú∫
            const targetCamPos = planeGroup.position.clone();
            targetCamPos.y = 35; 
            targetCamPos.z += 40;
            camera.position.copy(targetCamPos);
            
            // Â¶ÇÊûúÊòØÊöÇÂÅúÁä∂ÊÄÅÔºåËá™Âä®ÂºÄÂßãÈ£ûË°å‰ΩìÈ™å‰ºöÊõ¥Â•ΩÔºåÊàñËÄÖ‰øùÊåÅÊöÇÂÅú
            // ËøôÈáå‰øùÊåÅÂéüÁä∂ÊÄÅÔºåÂ¶ÇÊûúÊòØÊöÇÂÅúÁöÑÔºåÁî®Êà∑ÁÇπË∑≥ËΩ¨ÂêéËøòÊòØÊöÇÂÅúÁöÑÔºåÊñπ‰æøÁúãÈÇ£‰∏™Êúà
        };

        window.resetCamera = function() {
            jumpToMonth(0); // Áõ¥Êé•Ë∑≥Âõû1Êúà
            if(!isFlying) toggleFlight(); // Â¶ÇÊûúÊòØÊöÇÂÅúÁöÑÔºåÊÅ¢Â§çÈ£ûË°å
        }

        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let selectedObj = null;

        window.addEventListener('click', (e) => {
            // Âè™ÊúâÊöÇÂÅúÊó∂ÊâçÂÖÅËÆ∏ÁÇπÂáª‰∫§‰∫í
            if (isFlying) return;

            if (e.target.closest('.bottom-panel') || e.target.closest('.top-panel')) return;
            
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(clickableObjects);
            const tooltip = document.getElementById('tooltip');

            if (intersects.length > 0) {
                if(selectedObj) selectedObj.material.emissive.setHex(0x000000);
                selectedObj = intersects[0].object;
                selectedObj.material.emissive.setHex(0xaaaaaa);

                const data = selectedObj.userData;
                tooltip.style.display = 'block';
                tooltip.style.left = Math.min(e.clientX + 15, window.innerWidth - 200) + 'px';
                tooltip.style.top = e.clientY + 15 + 'px';
                
                document.getElementById('tt-metal').innerText = data.metalName;
                document.getElementById('tt-metal').className = `metal-tag tag-${data.metalId}`;
                document.getElementById('tt-date').innerText = data.date;
                document.getElementById('tt-price').innerText = '$' + data.price;
                const pEl = document.getElementById('tt-percent');
                pEl.innerText = (data.change >= 0 ? "+" : "") + data.change.toFixed(2) + "%";
                pEl.className = "percent " + (data.change >= 0 ? "txt-red" : "txt-green");
            } else {
                tooltip.style.display = 'none';
                if(selectedObj) selectedObj.material.emissive.setHex(0x000000);
                selectedObj = null;
            }
        });

        function animate() {
            requestAnimationFrame(animate);

            if (isFlying) {
                planeGroup.position.z -= currentSpeed;
                if (planeGroup.position.z < -totalDist) {
                    planeGroup.position.z = 20;
                }

                if (keys.Left) planeVelocityX -= acceleration;
                if (keys.Right) planeVelocityX += acceleration;
                if (keys.Up) planeVelocityY += acceleration;
                if (keys.Down) planeVelocityY -= acceleration;
                
                planeVelocityX = Math.max(-maxVel, Math.min(maxVel, planeVelocityX));
                planeVelocityY = Math.max(-maxVel, Math.min(maxVel, planeVelocityY));
                
                if (!keys.Left && !keys.Right) planeVelocityX *= friction;
                if (!keys.Up && !keys.Down) planeVelocityY *= friction;

                planeGroup.position.x += planeVelocityX;
                planeGroup.position.y += planeVelocityY;

                if (planeGroup.position.x < minX) { planeGroup.position.x = minX; planeVelocityX = 0; }
                if (planeGroup.position.x > maxX) { planeGroup.position.x = maxX; planeVelocityX = 0; }
                if (planeGroup.position.y < minY) { planeGroup.position.y = minY; planeVelocityY = 0; }
                if (planeGroup.position.y > maxY) { planeGroup.position.y = maxY; planeVelocityY = 0; }

                planeGroup.rotation.z = -planeVelocityX * 0.5;
                planeGroup.rotation.x = planeVelocityY * 0.3;

                const targetCamPos = planeGroup.position.clone();
                targetCamPos.y = Math.max(20, planeGroup.position.y + 10);
                targetCamPos.z += 40; 
                camera.position.lerp(targetCamPos, 0.08);
                
                const lookTarget = planeGroup.position.clone();
                lookTarget.z -= 20;
                camera.lookAt(lookTarget);

            } else {
                controls.update();
            }

            const labelZ = planeGroup.position.z - 30;
            hudLabels.forEach(label => {
                label.mesh.position.z = labelZ;
                label.mesh.position.y = 15 + Math.sin(Date.now() * 0.001) * 0.5;
                label.mesh.rotation.x = -Math.PI / 6; 
            });

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();

    </script>
</body>
</html>
